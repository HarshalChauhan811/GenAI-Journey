<!-- In line 546 paste your api key then it will work properly -->

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DSA Instructor AI ‚Äî ChatGPT Style</title>
  <style>
    :root {
      --primary: #00ffe7;
      --secondary: #0f0f0f;
      --bg: #121212;
      --text: #e0ffff;
      --ai-bg: #1a1a1a;
      --user-bg: #003333;
      --border-color: #00ffe7;
      --scrollbar-bg: #222;
      --scrollbar-thumb: #00ffbb;
      --font-family: 'Courier New', monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-family);
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-bg);
    }
    *::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    *::-webkit-scrollbar-track {
      background: var(--scrollbar-bg);
      border-radius: 10px;
    }
    *::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 10px;
      border: 2px solid var(--scrollbar-bg);
    }

    body {
      display: flex;
      height: 100vh;
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
    }

    .sidebar {
      width: 300px;
      background: #000;
      border-right: 2px solid var(--primary);
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 5px 0 25px #00ffe799;
      user-select: none;
    }

    .sidebar h2 {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 20px;
      text-align: center;
      text-shadow: 0 0 12px var(--primary);
      font-weight: 700;
      letter-spacing: 1.2px;
    }

    .new-chat {
      padding: 14px 12px;
      background: transparent;
      color: var(--primary);
      border: 2px dashed var(--primary);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      border-radius: 10px;
      text-align: center;
      user-select: none;
      letter-spacing: 0.8px;
    }
    .new-chat:hover {
      background: var(--primary);
      color: #000;
      font-weight: 700;
      box-shadow: 0 0 15px var(--primary);
    }

    .chats-list {
      margin-top: 25px;
      flex: 1;
      overflow-y: auto;
      border-top: 1px solid #004d4d;
      padding-top: 15px;
    }

    .chat-item {
      padding: 10px 15px;
      margin-bottom: 12px;
      border-radius: 8px;
      background: transparent;
      color: var(--primary);
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.2s ease;
      user-select: none;
    }

    .chat-item:hover, .chat-item.active {
      background: var(--primary);
      color: #000;
      font-weight: 700;
      box-shadow: 0 0 15px var(--primary);
    }

    .footer {
      text-align: center;
      font-size: 0.75rem;
      color: #555;
      user-select: none;
      margin-top: 15px;
      font-style: italic;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px 30px;
      overflow: hidden;
      background: linear-gradient(135deg, #001111 0%, #003333 100%);
      box-shadow: inset 0 0 70px #00ffee44;
      border-radius: 0 12px 12px 0;
      position: relative;
    }

    .chat-box {
      flex: 1;
      overflow-y: auto;
      padding-right: 15px;
      scroll-behavior: smooth;
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 10px;
    }

    .chat-bubble {
      max-width: 75%;
      padding: 14px 20px;
      border-radius: 20px;
      white-space: pre-wrap;
      font-size: 1rem;
      line-height: 1.4;
      position: relative;
      box-shadow: 0 0 12px #00ffe733;
      animation: fadeInUp 0.3s ease forwards;
      word-break: break-word;
    }

    .user {
      background: var(--user-bg);
      align-self: flex-end;
      border: 1.5px solid #00bbaa;
      color: #aaffff;
      font-weight: 600;
      border-bottom-right-radius: 4px;
    }

    .ai {
      background: var(--ai-bg);
      align-self: flex-start;
      border: 1.5px solid #007777;
      color: #b0ffff;
      border-bottom-left-radius: 4px;
    }

    /* Bubble tails */
    .user::after {
      content: "";
      position: absolute;
      bottom: 0;
      right: -12px;
      width: 12px;
      height: 12px;
      background: var(--user-bg);
      border-left: 1.5px solid #00bbaa;
      border-bottom: 1.5px solid #00bbaa;
      border-bottom-right-radius: 4px;
      transform: translateY(-2px) rotate(45deg);
    }
    .ai::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: -12px;
      width: 12px;
      height: 12px;
      background: var(--ai-bg);
      border-right: 1.5px solid #007777;
      border-bottom: 1.5px solid #007777;
      border-bottom-left-radius: 4px;
      transform: translateY(-2px) rotate(-45deg);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(15px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .timestamp {
      font-size: 0.7rem;
      color: #44ffcc88;
      margin-top: 6px;
      opacity: 0.6;
      user-select: none;
      font-style: italic;
    }

    .input-area {
      display: flex;
      gap: 15px;
      margin-top: 10px;
      align-items: center;
    }

    textarea {
      flex: 1;
      background: #111;
      border: 2px solid var(--primary);
      border-radius: 10px;
      padding: 15px;
      color: var(--text);
      font-size: 1.1rem;
      resize: none;
      min-height: 70px;
      max-height: 150px;
      transition: border-color 0.3s ease;
      box-shadow: inset 0 0 12px #00ffe7aa;
      font-family: var(--font-family);
    }

    textarea:focus {
      border-color: #00ccaa;
      outline: none;
      box-shadow: 0 0 18px #00ccaacc;
    }

    button {
      background: var(--primary);
      color: #000;
      font-weight: 700;
      border: none;
      border-radius: 10px;
      padding: 15px 30px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-shadow: 0 0 18px #00ffe7aa;
      user-select: none;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }
    button:hover:not(:disabled) {
      background: #00ccaa;
      box-shadow: 0 0 22px #00ccaaee;
    }

    /* Loading spinner for AI "Thinking..." */
    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid #00ffe7cc;
      border-top: 3px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
      align-self: center;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Responsive */
    @media (max-width: 900px) {
      .sidebar {
        width: 60px;
        padding: 15px 5px;
      }
      .sidebar h2,
      .new-chat,
      .footer {
        display: none;
      }
      .chats-list {
        margin-top: 0;
        border: none;
        overflow-x: hidden;
      }
      .chat-item {
        font-size: 0;
        padding: 10px 5px;
        margin-bottom: 10px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        line-height: 40px;
        text-align: center;
        border: 1.5px solid var(--primary);
      }
    }
    @media (max-width: 500px) {
      .main {
        padding: 15px 15px 20px 15px;
      }
      textarea {
        font-size: 1rem;
      }
      button {
        padding: 12px 20px;
      }
    }
  </style>
</head>
<body>

  <div class="sidebar" aria-label="Chat Sidebar">
    <div>
      <h2>üíª DSA  AI</h2>
      <button class="new-chat" title="Start a new chat" aria-label="New Chat" onclick="resetChat()">+ New Chat</button>
    </div>
    <div class="chats-list" id="chatsList" role="list" aria-label="Chat History">
      <!-- Previous chats will be added here -->
    </div>
    <div class="footer">Built with ‚ù§Ô∏è for DSA Learners</div>
  </div>

  <main class="main" role="main" aria-live="polite" aria-atomic="false">
    <div class="chat-box" id="chatBox" tabindex="0" aria-label="Chat Messages">
      <!-- Messages will appear here -->
    </div>
    <form class="input-area" onsubmit="event.preventDefault(); sendToAI();" role="search" aria-label="Ask your DSA question">
      <textarea
        id="userInput"
        placeholder="Ask your DSA question..."
        aria-required="true"
        aria-label="Type your question"
        rows="2"
      ></textarea>
      <button id="sendBtn" type="submit" aria-label="Send question">Ask</button>
    </form>
  </main>

  <script>
    const chatBox = document.getElementById('chatBox');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const chatsList = document.getElementById('chatsList');

    let chats = [];
    let currentChatId = null;
    let isLoading = false;

    function getCurrentTimestamp() {
      const now = new Date();
      return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function createChatId() {
      return 'chat-' + Date.now();
    }

    // Add message to chat window
    function addMessage(text, sender, timestamp = null) {
      const div = document.createElement('div');
      div.className = `chat-bubble ${sender}`;
      div.textContent = text;

      const time = document.createElement('div');
      time.className = 'timestamp';
      time.textContent = timestamp || getCurrentTimestamp();

      div.appendChild(time);
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Add message with loading spinner
    function addLoadingMessage() {
      const div = document.createElement('div');
      div.className = 'chat-bubble ai';
      div.id = 'loadingMessage';

      const span = document.createElement('span');
      span.textContent = 'Thinking...';
      div.appendChild(span);

      const spinner = document.createElement('div');
      spinner.className = 'spinner';
      div.appendChild(spinner);

      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function removeLoadingMessage() {
      const loading = document.getElementById('loadingMessage');
      if (loading) loading.remove();
    }

    // Reset chat
    function resetChat() {
      if (isLoading) return;
      chatBox.innerHTML = '';
      chats = [];
      currentChatId = createChatId();
      chatsList.innerHTML = '';
      updateChatsList();
    }

    // Update sidebar chats list
    function updateChatsList() {
      chatsList.innerHTML = '';
      chats.forEach((chat, idx) => {
        const item = document.createElement('div');
        item.className = 'chat-item' + (chat.id === currentChatId ? ' active' : '');
        item.textContent = chat.messages[0]?.text.slice(0, 30) || 'New Chat';
        item.title = 'Click to open chat';
        item.tabIndex = 0;
        item.setAttribute('role', 'listitem');
        item.onclick = () => {
          if (isLoading) return;
          currentChatId = chat.id;
          loadChat(chat.id);
        };
        item.onkeypress = (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            item.click();
          }
        };
        chatsList.appendChild(item);
      });
    }

    // Load chat by id
    function loadChat(chatId) {
      const chat = chats.find(c => c.id === chatId);
      if (!chat) return;
      chatBox.innerHTML = '';
      chat.messages.forEach(({text, sender, timestamp}) => addMessage(text, sender, timestamp));
      updateChatsList();
    }

    // Save message to chat history
    function saveMessageToChat(text, sender) {
      const timestamp = getCurrentTimestamp();
      if (!currentChatId) currentChatId = createChatId();
      let chat = chats.find(c => c.id === currentChatId);
      if (!chat) {
        chat = { id: currentChatId, messages: [] };
        chats.push(chat);
      }
      chat.messages.push({ text, sender, timestamp });
      updateChatsList();
    }

    // Check if question is about DSA (basic keyword check)
    function isDSAQuestion(question) {
      const dsaKeywords = [
        'algorithm', 'data structure', 'tree', 'graph', 'linked list', 'stack', 'queue',
        'binary', 'search', 'sort', 'hash', 'dynamic programming', 'dp', 'recursion',
        'binary search tree', 'heap', 'priority queue', 'dfs', 'bfs', 'traversal',
        'array', 'string', 'complexity', 'big o', 'time complexity', 'space complexity',
        'leetcode', 'codeforces', 'geeksforgeeks', 'segment tree', 'fenwick tree',
        'divide and conquer', 'greedy', 'backtracking', 'bitmask', 'union find', 'disjoint set'
      ];
      const lower = question.toLowerCase();
      return dsaKeywords.some(keyword => lower.includes(keyword));
    }

    // Main function to send user query and get AI response
    async function sendToAI() {
      if (isLoading) return;

      const question = userInput.value.trim();
      if (!question) return;

      // Add user message immediately
      addMessage(question, 'user');
      saveMessageToChat(question, 'user');

      // Clear input and disable input+button
      userInput.value = '';
      userInput.disabled = true;
      sendBtn.disabled = true;

      // Add AI loading message
      addLoadingMessage();

      isLoading = true;

      // System prompt with instructions for AI
      const systemInstruction = `You are a DSA Instructor. You will ONLY reply to questions related to Data Structures & Algorithms.
You must answer all DSA queries in the simplest and clearest way possible.

If the question is NOT related to Data Structures & Algorithms, reply rudely, for example:
User: How are you?
You: You dumb, ask me some sensible questions related to Data Structures & Algorithms!

Be straightforward and rude for unrelated questions. For DSA related questions, be polite and instructive.`;

      // Construct the payload for the Gemini API
      const payload = {
        contents: [
          {
            role: "user",
            parts: [{ text: question }]
          }
        ],
        system_instruction: {
          role: "system",
          parts: [{ text: systemInstruction }]
        }
      };

      try {
        const res = await fetch(
          'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=Paste your api key here',
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
          }
        );

        const data = await res.json();

        removeLoadingMessage();

        if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
          const reply = data.candidates[0].content.parts[0].text.trim();

          // Save AI reply to chat history and display
          addMessage(reply, 'ai');
          saveMessageToChat(reply, 'ai');
        } else {
          addMessage("Hmm, I couldn't understand that. Try asking a DSA related question.", 'ai');
          saveMessageToChat("Hmm, I couldn't understand that. Try asking a DSA related question.", 'ai');
        }

      } catch (err) {
        removeLoadingMessage();
        addMessage("Error: Could not contact AI. Please try again.", 'ai');
        saveMessageToChat("Error: Could not contact AI. Please try again.", 'ai');
        console.error(err);
      } finally {
        isLoading = false;
        userInput.disabled = false;
        sendBtn.disabled = false;
        userInput.focus();
      }
    }

    // Keyboard shortcut: Enter to send, Shift+Enter for new line
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendToAI();
      }
    });

    // On page load, initialize a fresh chat
    window.onload = () => {
      resetChat();
      userInput.focus();
    };
  </script>
</body>
</html>
